<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Subway_Main</title>
  <link rel="stylesheet" type="text/css" href="css/style.css">
</head>
<body>
<div class="header">
  <img id="header_logo" src="images/subway_logo.png">
  <img id="header_title" src="images/subway_title.png">
  <a href="index.html"><img id="header_close" src="images/x.png"></a>
</div>
<div class="charge_bar">
  <div>
    <button class="return_button charge_bar_button-style"><a href="index.html">초기화면</a></button>
    <button class="basket_button charge_bar_button-style">장바구니</button>
    <button class="payment_button charge_bar_button-style">결제하기</button>
  </div>
</div>
<div class="menu_bar">
  <div class="menu_button">
    <button class="sandwich_button"><a class="special-link button"><img src="images/sandwich.png"><br>샌드위치</a></button>
    <div class="indicator"></div>
    <button class="salad_button" data-target="salad_table"><img src="images/salad.png"><br>샐러드</button>
    <div class="indicator"></div>
    <button class="lab_button" data-target="lab_table"><img src="images/lab.png"><br>랩</button>
    <div class="indicator"></div>
    <button class="beverage_button" data-target="beverage_table"><img src="images/beverage.png"><br>사이드 & 음료</button>
    <div class="indicator"></div>
  </div>
</div>

<div class="main_content">
  <table id="sandwich_table">
    <tbody>
    <tr>
      <td><img src="images/sandwich/sandwich_eggmayo.png" data-product="sandwich_eggmayo"><br>4,900</td>
      <td><img src="images/sandwich/sandwich_italianBMT.png" data-product="sandwich_italianBMT"><br>6,100</td>
      <td><img src="images/sandwich/sandwich_BLT.png" data-product="sandwich_BLT"><br>6,000</td>
    </tr>
    <tr>
      <td><img src="images/sandwich/sandwich_chickenDeriyaki.png" data-product="sandwich_chickenDeriyaki"><br>6,400</td>
      <td><img src="images/sandwich/sandwich_chickenBaconAbocado.png" data-product="sandwich_chickenBaconAbocado"><br>7,400</td>
      <td><img src="images/sandwich/sandwich_bbq.png" data-product="sandwich_bbq"><br>6,700</td>
    </tr>
    <tr>
      <td><img src="images/sandwich/sandwich_chickenSlice.png" data-product="sandwich_chickenSlice"><br>5,900</td>
      <td><img src="images/sandwich/sandwich_club.png" data-product="sandwich_club"><br>6,500</td>
      <td><img src="images/sandwich/sandwich_ham.png" data-product="sandwich_ham"><br>5,200</td>
    </tr>
    <tr>
      <td><img src="images/sandwich/sandwich_hamEggCheese.png" data-product="sandwich_hamEggCheese"><br>7,400</td>
      <td><img src="images/sandwich/sandwich_porkBBQ.png" data-product="sandwich_porkBBQ"><br>6,600</td>
      <td><img src="images/sandwich/sandwich_roastedChicken.png" data-product="sandwich_roastedChicken"><br>6,700</td>
    </tr>
    <tr>
      <td><img src="images/sandwich/sandwich_shrimp.png" data-product="sandwich_shrimp"><br>6,500</td>
      <td><img src="images/sandwich/sandwich_spicyItalian.png" data-product="sandwich_spicyItalian"><br>6,300</td>
      <td><img src="images/sandwich/sandwich_SteakCheese.png" data-product="sandwich_SteakCheese"><br>7,400</td>
    </tr>
    <tr>
      <td><img src="images/sandwich/sandwich_vegi.png" data-product="sandwich_vegi"><br>4,400</td>
      <td><img src="images/sandwich/sandwich_westernEggCheese.png" data-product="sandwich_westernEggCheese"><br>6,700</td>
    </tr>
    </tbody>
  </table>
  <table id="salad_table" style="display: none">
    <tbody>
    <tr>
      <td><img src="images/salad/salad_BBQChicken.png" data-product="salad_BBQChicken"><br>8,400</td>
      <td><img src="images/salad/salad_BLT.png" data-product="salad_BLT"><br>7,700</td>
      <td><img src="images/salad/salad_ChickenBaconAbocado.png" data-product="salad_ChickenBaconAbocado"><br>9,100</td>
    </tr>
    <tr>
      <td><img src="images/salad/salad_chickenDeriyaki.png" data-product="salad_chickenDeriyaki"><br>8,100</td>
      <td><img src="images/salad/salad_chickenSlice.png" data-product="salad_chickenSlice"><br>7,600</td>
      <td><img src="images/salad/salad_club.png" data-product="salad_club"><br>8,200</td>
    </tr>
    <tr>
      <td><img src="images/salad/salad_eggMayo.png" data-product="salad_eggMayo"><br>6,600</td>
      <td><img src="images/salad/salad_fulledBBQ.png" data-product="salad_fulledBBQ"><br>8,300</td>
      <td><img src="images/salad/salad_ham.png" data-product="salad_ham"><br>6,900</td>
    </tr>
    <tr>
      <td><img src="images/salad/salad_italianBMT.png" data-product="salad_italianBMT"><br>7,800</td>
      <td><img src="images/salad/salad_KBBQ.png" data-product="salad_KBBQ"><br>8,400</td>
      <td><img src="images/salad/salad_newShrimp.png" data-product="salad_newShrimp"><br>8,400</td>
    </tr>
    <tr>
      <td><img src="images/salad/salad_RoastedChicken.png" data-product="salad_RoastedChicken"><br>8,200</td>
      <td><img src="images/salad/salad_spicyItalian.png" data-product="salad_spicyItalian"><br>8,000</td>
      <td><img src="images/salad/salad_spicyShrimp.png" data-product="salad_spicyShrimp"><br>8,200</td>
    </tr>
    <tr>
      <td><img src="images/salad/salad_steakCheese.png" data-product="salad_steakCheese"><br>9,100</td>
      <td><img src="images/salad/salad_tuna.png" data-product="salad_tuna"><br>6,900</td>
      <td><img src="images/salad/salad_vegi.png" data-product="salad_vegi"><br>6,100</td>
    </tr>
    </tbody>
  </table>
  <table id="lab_table" style="display: none">
    <tbody>
    <tr>
      <td><img src="images/wrap/wrap_chickenBaconMini.png" data-product="wrap_chickenBaconMini"><br>3,400</td>
      <td><img src="images/wrap/wrap_shrimpEggMayo.png" data-product="wrap_shrimpEggMayo"><br>5,300</td>
      <td><img src="images/wrap/wrap_steakCheeseAvocado.png" data-product="wrap_steakCheeseAvocado"><br>6,000</td>
    </tr>
    </tbody>
  </table>
  <table id="beverage_table" style="display: none">
    <tbody>
    <tr>
      <td><img src="images/beverage/beverage_soda.png" data-product="beverage_soda"><br>2,000</td>
      <td><img src="images/beverage/beverage_coffee.png" data-product="beverage_coffee"><br>2,000</td>
      <td><img src="images/beverage/beverage_hashBrown.png" data-product="beverage_hashBrown"><br>1,800</td>
    </tr>
    <tr>
      <td><img src="images/beverage/beverage_cheesy.png" data-product="beverage_cheesy"><br>2,400</td>
      <td><img src="images/beverage/beverage_cheesybacon.png" data-product="beverage_cheesybacon"><br>2,700</td>
      <td><img src="images/beverage/beverage_chip.png" data-product="beverage_chip"><br>2,200</td>
    </tr>
    <tr>
      <td><img src="images/beverage/beverage_chip_chocolate.png" data-product="beverage_chip_chocolate"><br>1,300</td>
      <td><img src="images/beverage/beverage_chip_doubleChocolate.png" data-product="beverage_chip_doubleChocolate"><br>1,300</td>
      <td><img src="images/beverage/beverage_chip_oatmealRaisin.png" data-product="beverage_chip_oatmealRaisin"><br>1,300</td>
    </tr>
    <tr>
      <td><img src="images/beverage/beverage_chip_raspberryCheese.png" data-product="beverage_chip_raspberryCheese"><br>1,300</td>
      <td><img src="images/beverage/beverage_chip_whiteChocoMacadamia.png" data-product="beverage_chip_whiteChocoMacadamia"><br>1,300</td>
      <td><img src="images/beverage/beverage_soup_bakedPotato.png" data-product="beverage_soup_bakedPotato"><br>3,200</td>
    </tr>
    <tr>
      <td><img src="images/beverage/beverage_soup_broccoliCheddar.png" data-product="beverage_soup_broccoliCheddar"><br>3,200</td>
      <td><img src="images/beverage/beverage_soup_mushroom.png" data-product="beverage_soup_mushroom"><br>3,200</td>
    </tr>
    </tbody>
  </table>
</div>
<div class="product-popup">
  <div class="product-popup-header">
    <img id="product-popup_logo" src="images/subway_logo.png">
    <h1 id="product-name"></h1>
    <button id="close-popup"><img src="images/x.png"></button>
  </div>
  <div class="product-details">
    <p id="product-price"></p>
    <img id="product-image" src="" alt="제품 이미지">
  </div>
  <div class="product-options">
    <div class="product-options-header">
      <h2 class="option_select_text">옵션 선택</h2>
    </div>
    <div class="breadOptions">
      <div class="breadSizeLabel">
        <label>
          <input type="radio" name="breadSize" data-group="breadSize" value="15cm">
          15cm
        </label>
        <label>
          <input type="radio" name="breadSize" data-group="breadSize" value="30cm">
          30cm (+4800)
        </label>
        <br>
        <label>
          <input type="radio" name="breadToasting" data-group="breadToasting" value="토스팅">
          토스팅
          <input type="radio" name="breadToasting" data-group="breadToasting" value="토스팅 안함">
          토스팅 안함
        </label>
        <br>
        <br>
      </div>
      <div class="breadLabel">
        <label>
          <input type="radio" name="bread" data-group="bread"  value="화이트">
          화이트
          <input type="radio" name="bread" data-group="bread"  value="플랫 브래드">
          플랫 브래드
          <input type="radio" name="bread" data-group="bread"  value="위트">
          위트
          <input type="radio" name="bread" data-group="bread"  value="하티">
          하티
          <input type="radio" name="bread" data-group="bread"  value="파마산오레가노">
          파마산오레가노
          <input type="radio" name="bread" data-group="bread"  value="허니오트">
          허니오트
        </label>
        <br>
        <br>
      </div>
    </div>
    <div class="cheeseLabel">
      <label>
        <input type="radio" name="cheese" data-group="cheese"  value="아메리칸 치즈">
        아메리칸 치즈
        <input type="radio" name="cheese" data-group="cheese"  value="슈레드 치즈">
        슈레드 치즈
        <input type="radio" name="cheese" data-group="cheese"  value="모차렐라 치즈">
        모차렐라 치즈
      </label>
      <br>
      <br>
    </div>
    <div class="sauceLabel">
      <label>
        <input type="checkbox" name="sauce" data-group="sauce" value="기본소스">
        기본소스
        <input type="checkbox" name="sauce" data-group="sauce" value="렌치드레싱">
        렌치드레싱
        <input type="checkbox" name="sauce" data-group="sauce" value="마요네즈">
        마요네즈
        <input type="checkbox" name="sauce" data-group="sauce" value="스위트 어니언">
        스위트 어니언
        <input type="checkbox" name="sauce" data-group="sauce" value="허니 머스타드">
        허니 머스타드
        <input type="checkbox" name="sauce" data-group="sauce" value="스위트 칠리">
        스위트 칠리
        <br>
        <input type="checkbox" name="sauce" data-group="sauce" value="핫 칠리">
        핫 칠리
        <input type="checkbox" name="sauce" data-group="sauce" value="사우스 웨스트">
        사우스 웨스트
        <input type="checkbox" name="sauce" data-group="sauce" value="머스타드">
        머스타드
        <input type="checkbox" name="sauce" data-group="sauce" value="홀스레디쉬">
        홀스레디쉬
        <input type="checkbox" name="sauce" data-group="sauce" value="올리브 오일">
        올리브 오일
        <input type="checkbox" name="sauce" data-group="sauce" value="레드와인식초">
        레드와인식초
        <br>
        <input type="checkbox" name="sauce" data-group="sauce" value="소금">
        소금
        <input type="checkbox" name="sauce" data-group="sauce" value="후추">
        후추
        <input type="checkbox" name="sauce" data-group="sauce" value="스모크 바비큐">
        스모크 바비큐
      </label>
      <br>
      <br>
    </div>
    <div class="vegetableLabel">
      <label>
        <input type="checkbox" name="vegetable" data-group="vegetable" value="양상추 제외">
        양상추 제외
        <input type="checkbox" name="vegetable" data-group="vegetable" value="토마토 제외">
        토마토 제외
        <input type="checkbox" name="vegetable" data-group="vegetable" value="오이 제외">
        오이 제외
        <input type="checkbox" name="vegetable" data-group="vegetable" value="피망 제외">
        피망 제외
        <input type="checkbox" name="vegetable" data-group="vegetable" value="양파 제외">
        양파 제외
        <input type="checkbox" name="vegetable" data-group="vegetable" value="피클 제외">
        피클 제외
        <br>
        <input type="checkbox" name="vegetable" data-group="vegetable" value="올리브 제외">
        올리브 제외
        <input type="checkbox" name="vegetable" data-group="vegetable" value="할라피뇨 제외">
        할라피뇨 제외
      </label>
      <br>
      <br>
    </div>
  </div>
  <div class="product-popup-footer">
    <button id="add-to-cart">장바구니에 담기</button>
  </div>
</div>

<div class="product-basket">
  <div class="product-basket-header">
    <img id="product-basket_logo" src="images/subway_logo.png">
    <button id="close-basket"><img src="images/x.png"></button>
  </div>
  <div id="basket-items"></div>
  <div class="product-basket-footer">
    <div id="total-price"></div>
    <div id="product-basket-charge">결제하기</div>
  </div>
</div>

<div class="product-charge">

</div>


<script>
  const cart = [];

  // "장바구니" 버튼 클릭 시 장바구니 팝업을 나타냄
  document.querySelector('.basket_button').addEventListener('click', function() {
    showShoppingCart();
  });

  // "닫기" 버튼 클릭 시 장바구니 팝업을 숨김
  document.querySelector('#close-basket').addEventListener('click', function() {
    hideShoppingCart();
  });

  function showShoppingCart() {
    const basketPopup = document.querySelector('.product-basket');
    basketPopup.style.display = 'block';

    // 장바구니 내용을 업데이트하고 합계 가격을 계산하여 표시
    const basketItems = document.querySelector('#basket-items');
    const totalPrice = document.querySelector('#total-price');
    basketItems.innerHTML = ''; // 장바구니 내용 초기화

    let total = 0;

    for (let i = 0; i < cart.length; i++) {
      total += cart[i].price;
      const itemElement = document.createElement('div');
      itemElement.textContent = `${cart[i].name} (${cart[i].options}): ${cart[i].price}원`;

      // "삭제" 버튼을 추가하고 해당 버튼을 클릭하면 아이템을 장바구니에서 제거
      const deleteButton = document.createElement('button');
      deleteButton.classList.add('delete-button'); // 스타일 클래스 추가
      deleteButton.textContent = ''; // 빈 문자열로 설정

      // "x_black" 이미지를 deleteButton 버튼의 배경 이미지로 설정
      deleteButton.style.backgroundImage = 'url("images/x_black.png")';
      deleteButton.style.backgroundSize = '20px 20px'; // 이미지 크기 조정
      deleteButton.style.width = '23px'; // 버튼의 너비 조정
      deleteButton.style.height = '23px'; // 버튼의 높이 조정
      deleteButton.dataset.index = i; // 아이템 인덱스를 저장

      deleteButton.addEventListener('click', function() {
        const index = this.dataset.index;
        cart.splice(index, 1); // 아이템을 장바구니에서 제거
        showShoppingCart(); // 장바구니를 업데이트하고 다시 표시
      });

      itemElement.appendChild(deleteButton);
      basketItems.appendChild(itemElement);
    }

    totalPrice.textContent = `합계: ${total}원`;
  }

  function hideShoppingCart() {
    document.querySelector('.product-basket').style.display = 'none';
  }

  // JSON 처리
  function loadProducts() {
    fetch('products.json')
      .then(response => response.json())
      .then(productsData => {
        var imageElements = document.querySelectorAll('#sandwich_table img, #salad_table img, #lab_table img, #beverage_table img');
        imageElements.forEach(function(img) {
          img.addEventListener('click', function(event) {
            // console.log(event)
            var productName = event.target.dataset.product;
            // console.log(productName)
            var productInfo = productsData[productName];
            if (productInfo) {
              var productName = productInfo.name;
              var productPrice = productInfo.price;
              var productImage = productInfo.img;

              document.getElementById('product-name').textContent = productName;
              document.getElementById('product-price').textContent = '가격: ' + productPrice + '원';

              document.getElementById('product-image').src = productImage;

              // "장바구니에 담기" 버튼 클릭 시

              function add() {
                // console.log(productName)
                const selectedOptions = {
                  breadSize: [],
                  breadToasting: [],
                  bread: [],
                  cheese: [],
                  sauce: [],
                  vegetable: []
                };

                const breadSizeRadios = document.querySelectorAll('input[name="breadSize"]');
                breadSizeRadios.forEach((radio) => {
                  if (radio.checked) {
                    selectedOptions.breadSize.push(radio.value);
                  }
                });

                const breadToastingRadios = document.querySelectorAll('input[name="breadToasting"]');
                breadToastingRadios.forEach((radio) => {
                  if (radio.checked) {
                    selectedOptions.breadToasting.push(radio.value);
                  }
                });

                const breadRadios = document.querySelectorAll('input[name="bread"]');
                breadRadios.forEach((radio) => {
                  if (radio.checked) {
                    selectedOptions.bread.push(radio.value);
                  }
                });

                const cheeseRadios = document.querySelectorAll('input[name="cheese"]');
                cheeseRadios.forEach((radio) => {
                  if (radio.checked) {
                    selectedOptions.cheese.push(radio.value);
                  }
                });

                const sauceCheckboxes = document.querySelectorAll('input[name="sauce"]');
                sauceCheckboxes.forEach((checkbox) => {
                  if (checkbox.checked) {
                    selectedOptions.sauce.push(checkbox.value);
                  }
                });

                const vegetableCheckboxes = document.querySelectorAll('input[name="vegetable"]');
                vegetableCheckboxes.forEach((checkbox) => {
                  if (checkbox.checked) {
                    selectedOptions.vegetable.push(checkbox.value);
                  }
                });

                const selectedOptionsText = [];
                const optionGroups = ['breadSize', 'breadToasting', 'bread', 'cheese', 'sauce', 'vegetable'];
                optionGroups.forEach(group => {
                  if (selectedOptions[group].length > 0) {
                    selectedOptionsText.push(selectedOptions[group].join(', '));
                  }
                });

                let selectedOptionsString = selectedOptionsText.join(' | ');


                cart.push({
                  name: productName,
                  price: productPrice,
                  options: selectedOptionsString
                });
                alert('장바구니에 제품이 추가되었습니다.');
                document.getElementById('add-to-cart').removeEventListener('click', add)
              }
              document.getElementById('add-to-cart').addEventListener('click', add)
              // console.log(document.getElementById('add-to-cart'))
              document.querySelector('.product-popup').style.display = 'block';
            }
          });
        });
      })
  }



  // 플로팅 창 닫기 버튼
  document.querySelector('#close-popup').addEventListener('click', function() {
    document.querySelector('.product-popup').style.display = 'none';
    resetSelectedLabels();
  });

  function resetSelectedLabels() {
    const inputElements = document.querySelectorAll('input[type="radio"], input[type="checkbox"]');
    inputElements.forEach((inputElement) => {
      inputElement.checked = false;
    });
  }

  // products.json 파일을 불러와서 제품 정보를 처리
  loadProducts();

  // "샌드위치" 버튼 클릭 시
  document.querySelector('.sandwich_button').addEventListener('click', function() {
    showTable('sandwich_table');
    showOptionsForLabels('.product-options', '.breadOptions', '.sauceLabel', '.cheeseLabel', '.vegetableLabel', '.option_select_text');
  });

  // "샐러드" 버튼 클릭 시
  document.querySelector('.salad_button').addEventListener('click', function() {
    showTable('salad_table');
    showOptionsForLabels('.product-options', '.breadOptions', '.cheeseLabel', '.sauceLabel', '.vegetableLabel', '.option_select_text');
    hideOptionsForLabels('.breadOptions');
  });

  // "사이드 & 음료" 버튼 클릭 시
  document.querySelector('.beverage_button').addEventListener('click', function() {
    showTable('beverage_table');
    showOptionsForLabels('.product-options', '.breadOptions', '.sauceLabel', '.cheeseLabel', '.vegetableLabel');
    hideOptionsForLabels('.product-options');
  });

  // "랩/기타" 버튼 클릭 시
  document.querySelector('.lab_button').addEventListener('click', function() {
    showTable('lab_table');
    showOptionsForLabels('.product-options', '.breadOptions', '.sauceLabel', '.cheeseLabel', '.vegetableLabel');
    hideOptionsForLabels('.product-options');
  });


  // 라벨 숨기기 함수
  function hideOptionsForLabels(...labels) {
    for (const label of labels) {
      const labelElements = document.querySelectorAll(label);
      labelElements.forEach((labelElement) => {
        labelElement.style.display = 'none';
      });
    }
  }

  function showOptionsForLabels(...labels) {
    for (const label of labels) {
      const labelElements = document.querySelectorAll(label);
      labelElements.forEach((labelElement) => {
        labelElement.style.display = 'block';
      });
    }
  }

  document.addEventListener("DOMContentLoaded", function() {
    // 페이지가 로드되면 초기 인디케이터 위치 설정
    moveIndicator(sandwichButton);
  });

  // 테이블 표시 함수
  function showTable(tableId) {
    const tables = document.querySelectorAll('table');
    tables.forEach((table) => {
      table.style.display = 'none';
    });
    document.getElementById(tableId).style.display = 'table';
  }

  const sandwichButton = document.querySelector('.sandwich_button');
  const saladButton = document.querySelector('.salad_button');
  const labButton = document.querySelector('.lab_button');
  const beverageButton = document.querySelector('.beverage_button');
  const indicator = document.querySelector('.indicator');

  function moveIndicator(button) {
    const buttonRect = button.getBoundingClientRect();
    const indicatorRect = indicator.getBoundingClientRect();

    indicator.style.display = 'block';
    indicator.style.top = buttonRect.bottom + 'px';
    indicator.style.left = buttonRect.left + buttonRect.width / 2 - indicatorRect.width / 2 + 'px';
  }

  const sandwichTable = document.getElementById('sandwich_table');
  const saladTable = document.getElementById('salad_table');
  const labTable = document.getElementById('lab_table');
  const beverageTable = document.getElementById('beverage_table');

  sandwichButton.addEventListener('click', () => {
    sandwichTable.style.display = 'table';
    saladTable.style.display = 'none';
    labTable.style.display = 'none';
    beverageTable.style.display = 'none';
    moveIndicator(sandwichButton);
  });

  saladButton.addEventListener('click', () => {
    saladTable.style.display = 'table';
    sandwichTable.style.display = 'none';
    beverageTable.style.display = 'none';
    labTable.style.display = 'none';
    moveIndicator(saladButton);
  });

  labButton.addEventListener('click', () => {
    labTable.style.display = 'table';
    saladTable.style.display = 'none';
    sandwichTable.style.display = 'none';
    beverageTable.style.display = 'none';
    moveIndicator(labButton);
  })

  beverageButton.addEventListener('click', () => {
    beverageTable.style.display = 'table';
    saladTable.style.display = 'none';
    sandwichTable.style.display = 'none';
    labTable.style.display = 'none';
    moveIndicator(beverageButton);
  } )
</script>
</body>
</html>